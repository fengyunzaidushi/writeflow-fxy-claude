# Epic: WriteFlow 命令系统重新设计 - Brownfield Enhancement

**Epic ID:** EPIC-001  
**创建时间:** 2025-08-31  
**状态:** Draft  
**负责人:** PM (John)

## Epic 目标

重新设计 WriteFlow 的命令系统，使其从技术导向转变为真正实用的作者工具，增加核心写作命令（写作、润色、扩展、续写等），简化命令参数，提升用户体验。

## Epic 描述

### 现有系统背景：
- **当前功能：** WriteFlow v2.2.6，基于 TypeScript + React + Ink 的 AI 写作助手
- **技术栈：** Node.js 18+, TypeScript, React, Ink UI, Anthropic Claude API
- **集成点：** 命令系统位于 `src/cli/commands/` 目录，包含核心命令、风格命令、发布命令等

### 当前问题分析

1. **命令设计问题：**
   - 现有命令过于技术化，不符合作者实际写作流程
   - 缺少常用的写作命令如：写作、扩展、润色、续写、总结等
   - 命令参数复杂，不够直观

2. **缺失的核心功能：**
   - 没有直接的 `/write` 或 `/compose` 命令来创作内容
   - 缺少 `/expand` 扩展内容命令
   - 缺少 `/polish` 润色命令
   - 缺少 `/continue` 续写命令
   - 缺少 `/summarize` 总结命令
   - 缺少 `/grammar` 语法检查命令

3. **用户体验问题：**
   - 命令不够直观，需要记忆复杂参数
   - 缺少写作流程引导
   - 工具调用不透明

### 增强详情：
- **新增核心写作命令：** `/write`, `/draft`, `/compose`, `/polish`, `/expand`, `/simplify`, `/continue`
- **新增辅助工具命令：** `/grammar`, `/summarize`, `/translate`, `/check`
- **简化现有命令的参数结构，** 使其更直观易用
- **重新设计 `/help` 命令的显示格式，** 按功能分类展示
- **集成方式：** 扩展现有的 SlashCommand 系统，保持向后兼容

### 成功标准：
- 用户能够使用直观的命令进行日常写作任务
- 命令参数简化，学习成本降低
- 保持现有功能完整性和性能

## Stories 分解

### Story 1: 核心写作命令实现
**目标：** 在 `src/cli/commands/core-commands.ts` 中新增基础创作命令

**功能范围：**
- `/write <主题>` - 直接写作文章
- `/draft <主题>` - 快速起草
- `/compose <类型> <主题>` - 指定类型创作
- 实现智能提示生成和工具集成

**验收标准：**
- 命令能正确识别和解析参数
- 生成合适的 AI 提示进行内容创作
- 与现有工具系统正确集成
- 现有命令功能不受影响

### Story 2: 内容优化命令实现  
**目标：** 新增内容优化相关命令

**功能范围：**
- `/polish [内容]` - 润色文本
- `/expand <内容>` - 扩展深度
- `/simplify <内容>` - 简化表达  
- `/continue [文件]` - 续写内容
- 支持文件路径和直接内容输入

**验收标准：**
- 支持文件路径和直接文本输入两种方式
- 能正确读取和处理文件内容
- 生成针对性的优化提示
- 处理各种边界情况（空文件、大文件等）

### Story 3: 辅助工具命令和 Help 系统重构
**目标：** 实现辅助工具命令和改进帮助系统

**功能范围：**
- `/grammar [文件]` - 语法检查
- `/summarize <内容>` - 总结提炼
- `/translate <语言> <内容>` - 翻译内容
- `/check [文件]` - 事实核查
- 重构 `/help` 命令，按功能分类显示，提升用户体验

**验收标准：**
- 辅助工具命令正常工作
- Help 系统按功能分类清晰展示
- 支持单个命令的详细帮助
- 新用户能快速上手使用

## 兼容性要求

- ✅ 现有 API (`SlashCommand` 接口) 保持不变
- ✅ 现有命令 (`/outline`, `/rewrite`, `/research`) 继续工作
- ✅ UI 组件 (React + Ink) 遵循现有模式
- ✅ 性能影响最小化（复用现有工具系统）

## 风险缓解

### 主要风险：
新命令可能与现有命令系统产生冲突或性能问题

### 缓解措施：
- 采用渐进式添加，每个 Story 独立测试
- 复用现有的 `AgentContext` 和工具系统
- 保持命令注册机制不变
- 在测试环境充分验证后再合并

### 回滚计划：
- 可以通过 Git 回滚到特定提交
- 或者临时禁用新增命令
- 保持现有命令的独立性，确保核心功能不受影响

## 完成定义 (Definition of Done)

- ✅ 所有 Stories 完成，新命令正常工作
- ✅ 现有功能通过回归测试验证
- ✅ 命令系统集成正确，无冲突
- ✅ 文档和帮助信息更新完成
- ✅ 现有功能无回归问题
- ✅ 用户体验测试通过
- ✅ 性能测试满足要求

## 预期影响

### 用户体验改善：
- 写作流程更自然，符合作者思维习惯
- 学习成本降低，新用户更容易上手
- 命令更直观，减少记忆负担

### 功能完整性：
- 覆盖完整的写作工作流：创作 → 优化 → 辅助工具
- 提供专业的写作辅助功能
- 保持技术专业性和易用性的平衡

## Story Manager 交接说明

请为这个 brownfield epic 开发详细的用户故事。关键考虑因素：

- **技术环境：** 这是对现有 WriteFlow v2.2.6 系统的增强，运行在 TypeScript + React + Ink 技术栈上
- **集成点：** 命令系统 (`src/cli/commands/`)、SlashCommand 接口、AgentContext 系统
- **现有模式：** 基于 `type: 'prompt'` 和 `type: 'local'` 的命令结构
- **关键兼容性要求：** 保持现有命令工作正常，不破坏 UI 系统
- **测试要求：** 每个故事必须包含验证现有功能保持完整的测试

这个 epic 应该在保持系统完整性的同时，实现让 WriteFlow 成为真正实用的作者写作工具的目标。

## 附录：新命令设计示例

### /write 命令示例
```typescript
{
  name: 'write',
  aliases: ['写作', 'w'],
  description: '直接写作文章',
  usage: '/write <主题或要求>',
  
  async getPromptForCommand(args: string): Promise<string> {
    return `请根据以下要求写作：

${args}

要求：
1. 结构清晰，逻辑连贯
2. 语言流畅，表达准确
3. 适当使用例子和数据支撑
4. 保持专业性和可读性平衡`
  }
}
```

### 改进后的 Help 显示格式
```
WriteFlow AI 写作助手 - 命令参考

📝 创作命令:
  /write <主题>         写作文章
  /draft <主题>         快速起草
  /compose <类型> <主题> 指定类型创作

✨ 优化命令:
  /polish [内容]        润色文本
  /expand <内容>        扩展深度
  /simplify <内容>      简化表达
  /continue [文件]      续写内容

🔧 工具命令:
  /grammar [文件]       语法检查
  /summarize <内容>     总结提炼
  /translate <语言>     翻译内容
  /check [文件]         事实核查

📚 研究命令:
  /outline <主题>       生成大纲
  /research <主题>      深度研究
  /cite <来源>          引用管理
```

---

**创建日期：** 2025-08-31  
**最后更新：** 2025-08-31  
**下一步：** 交给 Story Manager 创建详细用户故事